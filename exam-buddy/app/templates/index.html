{% extends "base.html" %}

{% block title %}Dashboard - Exam Buddy{% endblock %}

{% block content %}
<div class="dashboard-header">
    <h1><i class="fas fa-tachometer-alt"></i> Exam Dashboard</h1>
    <div class="dashboard-actions">
        <a href="{{ url_for('main.add_exam') }}" class="btn btn-primary">
            <i class="fas fa-plus"></i>
        </a>
    </div>
</div>

<div class="search-sort-container">
    <form method="GET" class="search-form">
        <div class="search-group">
            <input type="text" name="search" placeholder="Search exams..." value="{{ search }}" class="search-input">
            <button type="submit" class="search-btn"><i class="fas fa-search"></i></button>
        </div>
        <div class="sort-group">
            <select name="sort" class="sort-select" onchange="this.form.submit()">
                <option value="date" {% if sort_by == 'date' %}selected{% endif %}>Sort by Date</option>
                <option value="title" {% if sort_by == 'title' %}selected{% endif %}>Sort by Title</option>
                <option value="created" {% if sort_by == 'created' %}selected{% endif %}>Sort by Created</option>
            </select>
        </div>
    </form>
</div>

{% if exams %}
    <div class="exams-grid">
        {% for exam in exams %}
            <div class="exam-card">
                <div class="exam-header">
                    <h3>{{ exam.title }}</h3>
                    <div class="exam-actions">
                        <a href="{{ url_for('main.exam_detail', exam_id=exam.id) }}" class="btn btn-sm btn-secondary">
                            <i class="fas fa-eye"></i>
                        </a>
                        <a href="{{ url_for('main.edit_exam', exam_id=exam.id) }}" class="btn btn-sm btn-warning">
                            <i class="fas fa-edit"></i>
                        </a>
                        <a href="{{ url_for('main.delete_exam', exam_id=exam.id) }}" 
                           class="btn btn-sm btn-danger" 
                           onclick="return confirm('Are you sure you want to delete this exam?')">
                            <i class="fas fa-trash"></i>
                        </a>
                    </div>
                </div>
                
                <div class="exam-info">
                    <p class="exam-subject"><i class="fas fa-book"></i> {{ exam.subject }}</p>
                    <p class="exam-date">
                        <i class="fas fa-calendar"></i> 
                        {{ exam.date.strftime('%B %d, %Y') }}
                        {% if exam.time %}
                            at {{ exam.time.strftime('%H:%M') }}
                        {% endif %}
                    </p>
                    {% if exam.description %}
                        <p class="exam-description">{{ exam.description[:100] }}{% if exam.description|length > 100 %}...{% endif %}</p>
                    {% endif %}
                </div>
                
                <div class="exam-progress">
                    <div class="progress-info">
                        <span>Progress: {{ exam.progress_percentage() }}%</span>
                        <span class="task-count">{{ exam.tasks|selectattr('completed')|list|length }}/{{ exam.tasks|length }} tasks</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: {{ exam.progress_percentage() }}%"></div>
                    </div>
                </div>
                
                <div class="exam-stats">
                    <div class="stat">
                        <i class="fas fa-tasks"></i>
                        <span>{{ exam.tasks|length }} Tasks</span>
                    </div>
                    <div class="stat">
                        <i class="fas fa-file-alt"></i>
                        <span>{{ exam.notes|length }} Notes</span>
                    </div>
                    <div class="stat">
                        <i class="fas fa-clock"></i>
                        <span class="days-remaining" data-exam-date="{{ exam.date.isoformat() }}"></span>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
{% else %}
    <div class="empty-state">
        <i class="fas fa-graduation-cap empty-icon"></i>
        <h2>No Exams Found</h2>
        <p>{% if search %}No exams match your search criteria.{% else %}Get started by adding your first exam!{% endif %}</p>
        <a href="{{ url_for('main.add_exam') }}" class="btn btn-primary">
            <i class="fas fa-plus"></i> Add Your First Exam
        </a>
    </div>
{% endif %}
{% endblock %}

{% block scripts %}
<script>
// Calculate days remaining for each exam
document.addEventListener('DOMContentLoaded', function() {
    const daysRemainingElements = document.querySelectorAll('.days-remaining');
    
    daysRemainingElements.forEach(element => {
        const examDate = new Date(element.dataset.examDate);
        const today = new Date();
        const timeDiff = examDate.getTime() - today.getTime();
        const daysDiff = Math.ceil(timeDiff / (1000 * 3600 * 24));
        
        if (daysDiff > 0) {
            element.textContent = `${daysDiff} days left`;
            element.className += ' days-positive';
        } else if (daysDiff === 0) {
            element.textContent = 'Today!';
            element.className += ' days-today';
        } else {
            element.textContent = 'Past due';
            element.className += ' days-past';
        }
    });
});
</script>
{% endblock %}
